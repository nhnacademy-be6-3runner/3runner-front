<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Member Details</title>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%; /* Adjust size as needed */
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    </style>
</head>
<body>
<h1>Member Details</h1>
<div>
    <h2>Member Information</h2>
    <p>Email: <span th:text="${member.email()}"></span></p>
    <p>Name: <span th:text="${member.name()}"></span></p>
    <p>Age: <span th:text="${member.age()}"></span></p>
    <p>Phone: <span th:text="${member.phone()}"></span></p>
    <p>Birthday: <span th:text="${member.birthday()}"></span></p>
    <p>Point: <span th:text="${member.point()}"></span></p>
    <p>Greade: <span th:text="${member.grade()}"></span></p>
    <p>Created_at: <span th:text="${member.created_at()}"></span></p>
    <button id="editMemberBtn">멤버 수정하기</button>
</div>
<div id="memberEditModal" class="modal hidden">
    <div class="modal-content">
        <span class="close">&times;</span>
        <form id="editMemberForm">
            <h2>멤버 정보 수정</h2>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required value="${member.email}">

            <label for="name">Name:</label>
            <input type="text" id="membername" name="name" required value="${member.name}">

            <label for="age">Age:</label>
            <input type="number" id="age" name="age" required value="${member.age}">

            <!-- 추가 필드 작성 -->
            <button type="submit">저장하기</button>
        </form>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var editModal = document.getElementById('memberEditModal');
        var closeModal = editModal.querySelector('.close');
        var editBtn = document.getElementById('editMemberBtn');
        var saveBtn = document.getElementById('editMemberForm');

        editBtn.onclick = function() {
            editModal.style.display = 'block';
        };

        closeModal.onclick = function() {
            editModal.style.display = 'none';
        };

        saveBtn.onsubmit = function(event) {
            event.preventDefault();  // 폼의 기본 제출 방지
            var formData = new FormData(saveBtn);

            var object = {};
            formData.forEach(function(value, key){
                object[key] = value;
            });
            var json = JSON.stringify(object);

            fetch('/member/update', {
                method: 'PUT',  // HTTP 메소드 지정
                headers: {
                    'Content-Type': 'application/json',  // 콘텐츠 타입 지정
                },
                body: json  // 요청 본문에 JSON 데이터 첨부
            })
                .then(response => {
                    if (response.ok) {
                        alert('정보가 업데이트 되었습니다.');
                        window.location.reload();  // 페이지 새로고침
                    } else {
                        alert('정보 업데이트에 실패했습니다.');
                    }
                })
                .catch(error => console.error('Error:', error));
        };
    });
</script>


<div>
    <h2>Addresses</h2>
    <ul>
        <!-- 주소 목록을 반복해서 표시 -->
        <li th:each="address : ${addresses}" th:if="${not #lists.isEmpty(addresses)}">
            <span th:text="${address.name} + ', ' + ${address.country} + ', ' + ${address.city}
                + ', ' + ${address.state} + ', ' + ${address.road}+ ', ' + ${address.postalCode}"></span>
            <!-- 삭제 버튼 추가, 'deleteAddress' 자바스크립트 함수에 주소 ID 전달 -->
            <button type="button" th:onclick="'deleteAddress(' + ${address.id} + ');'">Delete</button>
        </li>
    </ul>
    <button id="createAddressBtn">새로운 주소 생성하기</button>
    <div id="addressModal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <form id="addressForm">
                <div id="modalBody">
                    <h2>새 주소 추가</h2>
                    <label for="name">이름:</label>
                    <input type="text" id="name" name="addressname" required minlength="1" maxlength="20" placeholder="이름 입력">

                    <label for="country">국가:</label>
                    <input type="text" id="country" name="country" required minlength="1" maxlength="100" placeholder="국가 입력">

                    <label for="city">도시:</label>
                    <input type="text" id="city" name="city" required minlength="1" maxlength="100" placeholder="도시 입력">

                    <label for="state">주/지역:</label>
                    <input type="text" id="state" name="state" required minlength="1" maxlength="100" placeholder="주/지역 입력">

                    <label for="road">도로명:</label>
                    <input type="text" id="road" name="road" required minlength="1" maxlength="100" placeholder="도로명 입력">

                    <label for="postalCode">우편번호:</label>
                    <input type="text" id="postalCode" name="postalCode" required minlength="1" maxlength="20" placeholder="우편번호 입력">
                </div>
                <div class="modal-footer">
                    <button type="submit" id="saveBtn">저장하기</button>
                    <button type="button" class="close" id="cancelBtn">취소하기</button>
                </div>
            </form>
        </div>
    </div><!--모달 창 열고 닫는거-->

</div>

<script th:inline="javascript">
    /* 자바스크립트로 주소 삭제 요청 처리 */
    function deleteAddress(addressId) {
        if(confirm('Are you sure you want to delete this address?')) {
            // AJAX를 사용하여 서버에 삭제 요청, 이때 addressId를 헤더에 추가
            fetch('/address/delete', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'Address-ID': addressId // 요청 헤더로 Address-ID 추가
                }
            })
                .then(response => {
                    if(response.ok) {
                        alert('Address deleted successfully');
                        window.location.reload(); // 페이지 새로고침
                    } else {
                        alert('Failed to delete address');
                    }
                })
                .catch(error => console.error('Error deleting address:', error));
        }
    }
</script>
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        var modal = document.getElementById('addressModal');
        var closeModal = document.getElementsByClassName('close');
        var createBtn = document.getElementById('createAddressBtn');
        var saveBtn = document.getElementById('saveBtn');
        var cancelBtn = document.getElementById('cancelBtn');

        // 모달 열기
        createBtn.onclick = function() {
            modal.style.display = 'block';
        };

        // 'close' 클래스를 가진 요소에 대해 모달 닫기 이벤트 연결
        Array.from(closeModal).forEach(function(element) {
            element.onclick = function() {
                modal.style.display = 'none';
            };
        });

        // 저장하기 버튼 이벤트 처리
        saveBtn.onclick = function() {
            // 폼 데이터를 수집하고 서버에 전송하는 로직 구현 (예: fetch API 사용)
            // 예시: 폼 데이터를 수집하여 서버로 POST 요청
            const formData = new FormData(document.querySelector('#modalBody form'));
            fetch('/member/save', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        alert('저장 성공');
                        modal.style.display = 'none';
                        window.location.reload(); // 데이터 반영을 위해 페이지 새로고침
                    } else {
                        alert('저장 실패');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('오류 발생');
                });
        };

        // 모달 외부 클릭시 모달 닫기
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        };
    });
</script>


</body>
</html>
